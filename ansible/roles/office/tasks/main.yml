---
- name: Install office tools
  aur:
    name: "{{ item }}"
  become: yes
  become_user: aur_builder
  with_flattened: "{{ packages.office }}"

- name: Jail LibreOffice
  file: src=/usr/bin/firejail
        dest=/usr/local/bin/libreoffice
        state=link
  when: "'libreoffice-fresh' in packages.office"

- name: Verify LibreOffice firejail local profile exists
  file: path=/etc/firejail/libreoffice.local state=touch
  when: "'libreoffice-fresh' in packages.office"

- name: Restrict LibreOffice network access
  lineinfile:
    dest: /etc/firejail/libreoffice.local
    regexp: "^net"
    line: "net none"
  when: "'libreoffice-fresh' in packages.office"

- name: Restrict LibreOffice access to /etc
  lineinfile:
    dest: /etc/firejail/libreoffice.local
    regexp: "^private-etc"
    line: "private-etc firejail,libreoffice,fonts,passwd"
  when: "'libreoffice-fresh' in packages.office"

# Destination /etc/xdg/mimeapps.list does not exist
# - name: Set Zathura as default PDF viewer
#   lineinfile: dest=/etc/xdg/mimeapps.list
#               regexp=^application/pdf
#               state=present
#               line="application/pdf=zathura.desktop"
#   when: "'zathura-pdf-mupdf' in packages.office"

- name: Jail Zathura
  file: src=/usr/bin/firejail
        dest=/usr/local/bin/zathura
        state=link
  when: "'zathura-pdf-mupdf' in packages.office"
